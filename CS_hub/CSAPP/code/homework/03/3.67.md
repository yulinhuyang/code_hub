# 3.67

## A

```text
104  +------------------+
     |                  |
     |                  |
     |                  |
 64  +------------------+ <-- %rdi
     |                  |
     |                  |
     |                  |
 32  +------------------+
     |         z        |
 24  +------------------+
     |     s.p = &z     |
 16  +------------------+
     |    s.a[1] = y    |
  8  +------------------+
     |    s.a[0] = x    |
  0  +------------------+ <-- %rsp
```

## B

eval 传入了 (eval 的 %rsp) + 64 的内存地址，作为参数

## C

```text
(process 的 %rsp) + 24 ==> s.p     = &z
(process 的 %rsp) + 16 ==> s.a[1]  =  y
(process 的 %rsp) + 8  ==> s.a[0]  =  x

其中 (eval 的 %rsp) - 8 = (process 的 %rsp)
```

虽然 %rdi 中有 eval 传入的参数。但 %rdi 并不是 s 的内存地址。process 利用 %rsp+offset 来访问结构 s 内的值。

## D

```text
%rdi + 16 ==> r.q     = z
%rdi +  8 ==> r.u[1]  = x
%rdi      ==> r.u[0]  = y

%rdi 在 eval 和 process 中的值是一样的

```

## E

```text
104  +------------------+
     |                  |
     |                  |
     |                  |
 88  +------------------+
     |     r.q = z      |
 80  +------------------+
     |    r.u[1] = x    |
 72  +------------------+
     |    r.u[0] = y    |
 64  +------------------+ <-- %rdi(eval pass in)
     |                  |  \
     |                  |    -- %rax(process pass out)
     |                  |
 32  +------------------+
     |         z        |
 24  +------------------+
     |     s.p = &z     |
 16  +------------------+
     |    s.a[1] = y    |
  8  +------------------+
     |    s.a[0] = x    |
  0  +------------------+ <-- %rsp in eval
     |                  |
 -8  +------------------+ <-- %rsp in process
```

```text
(eval 的 %rsp) + 80 ==> r.q    = z
(eval 的 %rsp) + 72 ==> r.u[1] = x
(eval 的 %rsp) + 64 ==> r.u[0] = y

eval 利用 %rsp+offset 来访问 r 的元素
```

## F

调用者传递返回值的地址给被调用者，而非参数的地址。

被调用者返回的是返回值的地址。

被调用者利用 %rsp+offset 访问参数结构体的元素。