## 一致性Hash算法的基本原理

### 常规负载均衡/缓存策略及问题

#### 策略
通过对请求的id进行hash运算，再对机器总数取余，可实现数据的缓存。

#### 问题
在添加和摘除节点的时候，所有数据都需要根据id重新计算hash值，再对机器总数取余，然后进行大规模
的数据迁移。


### 一致性Hash算法

#### 实现原理
使用Hash环，先将数据的id通过hash函数转换成哈希值，再把这些数字头尾相连，想象成一个闭合的环形，
那么一个数据id在计算出哈希值之后认为对应到环上的一个位置，通过对数据的id进行hash计算，再映射
到环中，然后顺时针寻找离这个位置最近的机器，那么该机器就是该数据的归属。

这样实现可以避免增删节点造成的大规模数据迁移。

#### 虚拟节点
上述实现有一个问题，就是当机器很少的时候，可能节点在整个环上分布不均匀，从而导致各个节点负载不均
衡。解决方法是添加虚拟节点，每台机器根据不同的hash函数计算出多个hash值，对多个节点都放置一个服务
节点，即虚拟节点，具体可以在机器ip或者主机名后添加端口或者编号来实现，分别计算它们的hash值，节点变
多了，根据hash函数的性质，平衡性会变好，然后用一张映射表维护虚拟节点和实际节点的关系。

具体算法可以参考chord算法、KAD算法等。

